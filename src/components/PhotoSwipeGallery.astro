---
import { Image } from "astro:assets";
import type { GalleryImage } from "@utils/gallery";
import 'photoswipe/style.css';
import '@css/photoswipe.css';

interface Props {
  images: GalleryImage[];
  fullSizeImages: Array<{ src: string; width: number; height: number }>;
  galleryId: string;
}

const { images, fullSizeImages, galleryId } = Astro.props;
---

<div class="photoswipe-gallery" id={`gallery-${galleryId}`}>
  <div class="gallery-justified" data-pswp-gallery={galleryId} data-gallery-id={galleryId}>
    {
      images.map((image, index) => {
        const fullSizeImage = fullSizeImages[index];
        return (
          <a
            href={fullSizeImage.src}
            data-pswp-width={fullSizeImage.width}
            data-pswp-height={fullSizeImage.height}
            data-width={fullSizeImage.width}
            data-height={fullSizeImage.height}
            class="gallery-item"
            target="_blank"
            rel="noreferrer"
          >
            <Image
              src={image.src}
              width={1200}
              height={Math.round((1200 * fullSizeImage.height) / fullSizeImage.width)}
              sizes="(max-width: 500px) 400px, (max-width: 800px) 600px, (max-width: 1400px) 800px, 1200px"
              widths={[400, 600, 800, 1200]}
              format="webp"
              loading={index < 8 ? "eager" : "lazy"}
              decoding="async"
              alt={image.alt}
            />
            {image.title && <span class="hidden-caption">{image.title}</span>}
          </a>
        );
      })
    }
  </div>
</div>

<style>
  .photoswipe-gallery {
    width: 100%;
    margin: 2rem 0;
  }

  .gallery-justified {
    position: relative;
    width: 100%;
    /* height will be set dynamically by JavaScript */
  }

  .gallery-item {
    position: absolute;
    display: block;
    overflow: hidden;
    cursor: pointer;
    line-height: 0;
    /* left, top, width, height will be set dynamically by JavaScript */
  }

  .gallery-item:hover {
    opacity: 0.9;
  }

  /* Target both direct img and img within picture element */
  .gallery-item :global(img) {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.2s ease;
  }

  .gallery-item:hover :global(img) {
    transform: scale(1.05);
  }

  .hidden-caption {
    display: none;
  }
</style>
