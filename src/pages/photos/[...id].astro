---
import { getCollection, type CollectionEntry } from "astro:content";
import GalleryLayout from "@layouts/GalleryLayout.astro";
import Header from "@components/Header.astro";
import PhotoSwipeGallery from "@components/PhotoSwipeGallery.astro";
import { getGalleryImages } from "@utils/gallery";
import { isPublished } from "@utils/content";

export async function getStaticPaths() {
  // Get published (non-draft) galleries in production
  const galleries = await getCollection("galleries", isPublished);

  return galleries.map((gallery) => ({
    params: { id: gallery.id },
    props: { gallery },
  }));
}

interface Props {
  gallery: CollectionEntry<"galleries">;
}

const { gallery } = Astro.props;

// Build title with draft indicator
const title = gallery.data.title + (gallery.data.isDraft ? " (draft)" : "");

// Get gallery images using utility function
const galleryImages = await getGalleryImages(
  gallery.id,
  gallery.data.photos
);
---

<GalleryLayout title={title}>
  <Header
    title={title}
    subtitle={gallery.data.description}
    slot="header"
  />

  {galleryImages.length > 0 ? (
    <PhotoSwipeGallery
      images={galleryImages}
      galleryId={gallery.id}
    />
  ) : (
    <p>No images found in this gallery.</p>
  )}
</GalleryLayout>
